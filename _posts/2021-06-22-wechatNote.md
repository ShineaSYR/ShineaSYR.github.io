---
layout: post
title: ä¼ä¸šå¾®ä¿¡å®šæ—¶æé†’æœºå™¨äººğŸ¤–ï¸
categories: [plugin]
description: é€šè¿‡äº‘å‡½æ•°åŠä¼ä¸šå¾®ä¿¡æœºå™¨äººï¼Œåˆ›å»ºå®šæ—¶ä»»åŠ¡ï¼Œå®šæ—¶å‘é€æ¶ˆæ¯æé†’
keywords: äº‘å‡½æ•°, serverlessã€ä¼ä¸šå¾®ä¿¡
---

## å‰æœŸå‡†å¤‡
- éœ€è¦æœ‰ä¸€ä¸ªä¼ä¸šå¾®ä¿¡çš„ç¾¤ï¼ˆ3äººä»¥ä¸Šï¼‰ï¼Œä¸»è¦ç”¨äºæ‹¿åˆ°WebHookï¼›
- è…¾è®¯äº‘ or é˜¿é‡Œäº‘çš„è´¦å·ï¼Œæ­¤å¤„ä¸»è¦ä»¥è…¾è®¯äº‘è¿›è¡Œè¯´æ˜ï½
## åˆ›å»ºä¼ä¸šå¾®ä¿¡æœºå™¨äººğŸ¤–ï¸
æ­¥éª¤å¦‚ä¸‹ï¼š

- åœ¨PCç‰ˆæœ¬çš„ä¼ä¸šå¾®ä¿¡ï¼Œé¼ æ ‡å³é”®å‡ºç°ã€Œæ·»åŠ ç¾¤æœºå™¨äººã€
- å‡ºç°å¼¹çª—ï¼Œå¯ä»¥é€‰æ‹©ä½¿ç”¨å·²æœ‰æœºå™¨äººoræ–°å»ºæœºå™¨äººï¼Œç‚¹å‡»æœ€ä¸Šæ–¹ã€Œæ–°åˆ›å»ºä¸€ä¸ªæœºå™¨äººã€

![æ·»åŠ æœºå™¨äºº]({{ site.url }}/assets/images/wechat_webhook001.png)
- æœ€ååœ¨ç¾¤é‡Œä¼šå‡ºç°ä¸€ä¸ªæœºå™¨äººï¼Œæ˜¾ç¤ºWebHookåœ°å€ä¸º`https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=XXXX-XXXX`ï¼ˆPSï¼šæ­¤å¤„ä¸ºkeyä¸ºå®‰å…¨ç”¨Xç®€å•ç¤ºæ„ï¼ŒéçœŸå®ï¼ŒWebHookæ¯”è¾ƒå…³é”®ï¼Œä¸è¦éšæ„æ³„éœ²ï¼‰

![æˆåŠŸåˆ›å»ºæœºå™¨äºº]({{ site.url }}/assets/images/wechat_webhook002.png)
## é…ç½®äº‘å‡½æ•°
### 1.ç™»å½•[è…¾è®¯äº‘](https://cloud.tencent.com/)

æ­¤å¤„é»˜è®¤å¤§å®¶å·²æœ‰è…¾è®¯äº‘è´¦å·ï¼ˆè‹¥æ— ï¼Œç›´æ¥ä½¿ç”¨å¾®ä¿¡ç™»å½•+å®åè®¤è¯+æœåŠ¡åˆ†é…å³å¯ï¼‰

### 2.åˆ›å»ºä¸€ä¸ªå‡½æ•°æœåŠ¡
è¿›å…¥[äº‘å‡½æ•°æ¨¡å—](https://serverless.cloud.tencent.com/start?c=scf)ï¼Œé€‰æ‹©ä¸€ä¸ªå‡½æ•°æ¨¡æ¿ï¼Œåˆ›å»ºä¸€ä¸ªå‡½æ•°æœåŠ¡ã€‚

![é€‰å®šä¸€ä¸ªå‡½æ•°æ¨¡æ¿]({{ site.url }}/assets/images/wechat_webhook003.png)
### 3.å‡½æ•°æœåŠ¡é…ç½®
åŸºç¡€é…ç½®å¯æŒ‰ç…§æç¤ºè¿›è¡Œä¿®æ”¹ï¼Œç‚¹å‡»å®Œæˆï¼Œå‡½æ•°åˆ›å»ºæˆæœï¼Œæ­¤æ—¶ä¼šé»˜è®¤éƒ¨ç½²é»˜è®¤çš„HelloWorldä»£ç ï¼Œå¹¶è·³è½¬åˆ°å·¥ä½œå°ã€‚

### 4.å‡½æ•°æœåŠ¡-æ·»åŠ ä»£ç 
ç‚¹å‡»å·¦ä¾§çš„ã€å‡½æ•°ç®¡ç†ã€‘ï¼Œé€‰æ‹©å‡½æ•°ä»£ç tabé€‰é¡¹å¡ï¼Œé‡Œé¢å‡ºç°äº†ä»£ç ç¼–è¾‘åŒºåŸŸï¼Œå¯ä»¥çœ‹åˆ°ä¹‹å‰é»˜è®¤çš„ä»£ç ä¸ºâ€œå·²éƒ¨ç½²â€çŠ¶æ€ã€‚

![æ·»åŠ ä»£ç ]({{ site.url }}/assets/images/wechat_webhook004.png)
åœ¨ä»£ç ç¼–è¾‘åŒºåŸŸæ·»åŠ å¦‚ä¸‹ä»£ç 
```javascript
'use strict'
/**************************************************
 demo-show è¯´æ˜
 postDataé‡Œçš„contentéœ€è¦ä¿®æ”¹ä¸ºè‡ªå·±éœ€è¦çš„
 requesté‡Œçš„urléœ€è¦å¡«å†™ä¹‹å‰åˆ›å»ºçš„æœºå™¨äººå¯¹åº”çš„WebHook
 ***************************************************/
const request = require('request')

exports.main_handler = async (event, context, callback) => {

  return new Promise((resolve, reject) => {
    const date = dateFormat({
      time: +new Date(),
      format: 'yyyymmdd'
    })
    const postData = {
      "msgtype": "text",
      "text": {
        "content": "åˆæ˜¯å­¦ä¹ çŸ¥è¯†çš„ä¸€å¤©\nå¤§å®¶å¯ä»¥è®¿é—®é“¾æ¥:https://shineasyr.github.io/:",
        "mentioned_list":["@all"]
      }
    }
    request({
      url: 'åˆ›å»ºçš„æœºå™¨äººçš„WebHook',
      method: 'POST',
      headers: {
        "content-type": "application/json",
      },
      body: JSON.stringify(postData)
    }, function(err, res) {
      if (!err && res.statusCode == 200) {
        resolve('success')
      } else {
        reject(err)
      }
    });

  })

}

function dateFormat (options) {
  // optionsæ”¯æŒä¸¤ä¸ªå‚æ•°
  // formatï¼Œè¿”å›å­—ç¬¦ä¸²çš„æ ¼å¼,"yyyy/mm/dd hh:ii",
  // é™¤äº†å…¶ä¸­çš„å­—æ¯ä¹‹å¤–ï¼Œæ ‡ç‚¹ï¼Œåˆ†éš”ç¬¦ç­‰ï¼Œå¯ä»¥éšæ„ä¿®æ”¹
  // timeä¸ºä¸€ä¸ªæœ‰æ•ˆçš„æ—¶é—´ï¼Œå¯ä»¥æ˜¯å­—ç¬¦ä¸²ï¼Œå¯ä»¥æ˜¯å¯¹è±¡
  // å¦‚æœåªä¼ å…¥ä¸€ä¸ªå‚æ•°ï¼Œé‚£ä¹ˆè¯¥å‚æ•°ä¸ºformatçš„å€¼

  const format = options.format
  const t = new Date(options.time)
  const tf = num => (num < 10 ? '0' : '') + num

  return format.replace(/yyyy|mm|dd|hh|ii|ss/g, function (a) {
    switch (a) {
      case 'yyyy':
        return tf(t.getFullYear())
      case 'mm':
        return tf(t.getMonth() + 1)
      case 'dd':
        return tf(t.getDate())
      case 'hh':
        return tf(t.getHours())
      case 'ii':
        return tf(t.getMinutes())
      case 'ss':
        return tf(t.getSeconds())
    }
  })
}
```
æ·»åŠ åç‚¹å‡»éƒ¨ç½²ï¼Œä»£ç å³å¯éƒ¨ç½²æˆåŠŸï¼Œå¯ä»¥ç‚¹å‡»æµ‹è¯•æŒ‰é’®ï¼Œæ­¤æ—¶ç¾¤é‡Œä¼šæœ‰ä¸€ä¸ªæ¶ˆæ¯æç¤ºã€‚
### 5.å‡½æ•°æœåŠ¡åˆ›å»ºè§¦å‘å™¨ã€‚
ç‚¹å‡»å·¦ä¾§çš„ã€è§¦å‘ç®¡ç†ã€‘-ã€åˆ›å»ºè§¦å‘å™¨ã€‘ï¼Œåœ¨å¼¹å‡ºæ¡†é‡Œä¿®æ”¹ç›¸åº”è®¾å®šï¼Œä¸€èˆ¬è§¦å‘å‘¨æœŸé€‰æ‹©ã€Œè‡ªå®šä¹‰è§¦å‘å‘¨æœŸã€ï¼Œå¡«å†™ã€ŒCronè¡¨è¾¾å¼ã€

![åˆ›å»ºè§¦å‘å™¨]({{ site.url }}/assets/images/wechat_webhook005.png)

#### Cronè¡¨è¾¾å¼ä¸¾ä¾‹
- `0 30 15 * * WED *`ä¸ºæ¯å‘¨ä¸‰çš„15:30ç‚¹è§¦å‘ï¼Œå…¶ä¸­ç¬¬ä¸€ä½0ä»£è¡¨ç§’ï¼Œ30ä»£è¡¨åˆ†é’Ÿï¼Œ15ä»£è¡¨æ—¶ï¼ˆ24æ—¶è®¡æ—¶æ³•ï¼‰ï¼ŒWEDä¸ºå‘¨ä¸‰
- `*/5 * * * * * *` è¡¨ç¤ºæ¯5ç§’è§¦å‘ä¸€æ¬¡
- `0 0 2 1 * * *` è¡¨ç¤ºåœ¨æ¯æœˆçš„1æ—¥çš„å‡Œæ™¨2ç‚¹è§¦å‘
- `0 0 10,14,16 * * * *` è¡¨ç¤ºåœ¨æ¯å¤©ä¸Šåˆ10ç‚¹ï¼Œä¸‹åˆ2ç‚¹ï¼Œ4ç‚¹è§¦å‘

æ›´å¤šå…³äºCronçš„è¯´æ˜ï¼Œå¯ä»¥æŸ¥çœ‹[æ–‡æ¡£](https://cloud.tencent.com/document/product/583/9708#cron-.E8.A1.A8.E8.BE.BE.E5.BC.8F)




